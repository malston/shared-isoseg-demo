# ABOUTME: Project context and memory for Claude Code sessions
# ABOUTME: Documents architecture, key decisions, and project patterns

# Shared Isolation Segments Demo

## Project Purpose

Demonstrate how to use Cloud Foundry isolation segments with shared routing to isolate workloads transparently, with zero impact to developers, pipelines, or network infrastructure.

## Key Concepts

### Shared Routing Model
- TAS Gorouters handle traffic for both shared and isolation segment apps
- No dedicated routers, load balancers, or DNS changes needed
- Apps keep exact same routes/domains after migration
- Configuration: TAS tile Networking pane → "Accept requests for all isolation segments"

### Isolation Segment Tile Replication
- Use Broadcom's Replicator tool to create multiple tile instances from base tile
- Each replicated tile gets unique product name: `p-isolation-segment-<name>`
- Job names are transformed: `isolated_diego_cell` → `isolated_diego_cell_<name>` (hyphens become underscores)
- Example: `p-isolation-segment-small-cell` has job `isolated_diego_cell_small_cell`

## Project Structure

```bash
.
├── scripts/
│   ├── isolation-segment-tile-migration.sh  # Production tile management (SUPPORTED)
│   ├── isolation-segment-migration.sh       # BOSH direct (TESTING ONLY)
│   └── demo-isolation-segment-migration.sh  # Interactive demos
├── config/isolation-segment/
│   ├── product.yml                          # Ops Manager config template
│   ├── default-vars.yml                     # Default variable values
│   ├── small-cell-vars.yml                  # 3 cells, medium.disk
│   ├── medium-cell-vars.yml                 # 5 cells, medium.disk
│   ├── large-cell-vars.yml                  # 10 cells, automatic
│   └── secrets/                             # Gitignored SSL certs/keys
│       └── ssl-certs.yml
├── apps/cf-env/                             # Lightweight Go app for demos
├── isolation-segment-deployment-workflow.md # Step-by-step deployment guide
└── isolation-segments-performance-density.md # Comprehensive implementation guide
```

## Scripts Overview

### isolation-segment-tile-migration.sh (Production)
Commands:
- `download-tile` - Download tile from Pivnet
- `download-replicator` - Download Replicator tool
- `replicate-tile` - Create named tile instance
- `configure-segment` - Configure via om (auto-detects secrets)
- `register-segment` - Register in Cloud Controller

### demo-isolation-segment-migration.sh
Modes:
- **Single-segment**: Migrate one app, show before/after comparison
- **Dual-segment** (`--dual-segment`): Deploy two apps to two segments for side-by-side comparison

## Key Technical Decisions

### Secrets Management
- SSL certs/keys stored in `config/isolation-segment/secrets/` (gitignored)
- `configure-segment` auto-detects `secrets/ssl-certs.yml` if present
- Vars files only contain cert name, not the actual cert/key values

### Job Name Transformation
- Replicated tiles have modified job names
- Script extracts segment name from product name and transforms hyphens to underscores
- Example: `p-isolation-segment-small-cell` → job suffix `small_cell`

### Availability Zones
- `other_availability_zones` is a separate variable (list of AZ objects)
- Not derived from `singleton_availability_zone`
- Default: `[{name: az1}, {name: az2}]`

## Environment

- TAS 6.0.x or 10.x
- Ops Manager with `om` CLI
- Pivnet CLI for tile downloads
- CF CLI 8+

## Common Commands

```bash
# Configure a segment (secrets auto-detected)
./scripts/isolation-segment-tile-migration.sh configure-segment \
  --product p-isolation-segment-small-cell \
  --vars-file config/isolation-segment/small-cell-vars.yml

# Run single-segment demo
./scripts/demo-isolation-segment-migration.sh --automated --cleanup

# Run dual-segment demo
./scripts/demo-isolation-segment-migration.sh --dual-segment --automated --cleanup
```

## Gotchas

1. **Replicated tile job names**: Use underscores not hyphens (`small_cell` not `small-cell`)
2. **Isolated router properties**: Don't exist when using shared routing (0 router instances)
3. **Product name format**: Must be `p-isolation-segment-<name>` for script to detect segment name
4. **Secrets file**: Must be named `ssl-certs.yml` in `secrets/` folder for auto-detection


<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

*No recent activity*
</claude-mem-context>